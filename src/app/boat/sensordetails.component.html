<ActionBar title="Title" class="action-bar bg-darkblue">
    <NavigationButton text="{{'Back' | L}}" android.systemIcon="ic_menu_back" (tap)="goBack()"></NavigationButton>
    <Label [text]="(dataService.sensorFieldMap[field].name_by_cable.length > 0 ? (dataService.sensorFieldMap[field].cable.indexOf(dataService.deviceData[idDevice].external_voltage_cable) >= 0 ? dataService.sensorFieldMap[field].name_by_cable[dataService.sensorFieldMap[field].cable.indexOf(dataService.deviceData[idDevice].external_voltage_cable)] : dataService.sensorFieldMap[field].name_by_cable[dataService.sensorFieldMap[field].cable.indexOf(dataService.deviceData[idDevice].multisensor_cable)]) : dataService.sensorFieldMap[field].name) | L" class="alarm-text"></Label>

</ActionBar>

<GridLayout class="homeBackgroundImage"
            backgroundImage="~/assets/AppDesignSources_FreigestellteBilder_bg_harbour_gray.png">
    <PullToRefresh (refresh)="refreshList($event)">
        <ScrollView orientation="vertical" *ngIf="initialized" iosOverflowSafeArea="false">
            <StackLayout *ngIf="!dataService.isLoading">
                <boat-header [boatname]="dataService.deviceData[idDevice].name" [boat_image_small]="dataService.deviceData[idDevice].boat_image_small" [role]="dataService.deviceData[idDevice].role" [deviceType]="dataService.deviceData[idDevice].type"></boat-header>
                <StackLayout orientation="horizontal" height="60" marginTop="15">
                    <GridLayout
                            class="{{'interval-button' + (interval.id == selectedIntervalId ? '-selected' : '')}}" verticalAlignment="top" horizontalAlignment="center"
                            (tap)="setSelectedInterval(interval.id)" *ngFor="let interval of dataService.historyIntervalData">
                        <Label [text]="interval.name | L" verticalAlignment="center" horizontalAlignment="center"></Label>
                    </GridLayout>
                </StackLayout>
                <StackLayout orientation="vertical" padding="10" class="alarm-card t-18" [visibility]="selectedIntervalId > 2 && !dataService.deviceData[idDevice].is_pro ? 'visible' : 'collapsed'">
                    <TextView fontSize="18" text="{{'Please buy Pro' | L}}"></TextView>
                </StackLayout>
                <StackLayout orientation="vertical" padding="10" class="alarm-card" [visibility]="selectedIntervalId <= 2 || dataService.deviceData[idDevice].is_pro ? 'visible' : 'collapsed'">
                    <RadCartesianChart style="height: 350; padding-bottom: 45" id="{{field}}_0">
                        <LinearAxis tkCartesianVerticalAxis
                                    labelLayoutMode="outer"
                                    [minimum]="(dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Min[intervalKeys[selectedIntervalId]] ? (((dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Min[intervalKeys[selectedIntervalId]] / dataService.sensorFieldMap[field].majorStep) - 0.49) | number:'2.0-0') * dataService.sensorFieldMap[field].majorStep : 0)"
                                    [maximum]="(dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]] ? ((((dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]] + 1) / dataService.sensorFieldMap[field].majorStep) + 0.5) | number:'2.0-0') * dataService.sensorFieldMap[field].majorStep : dataService.sensorFieldMap[field].majorStep)"
                                    [labelFormat]="'%.0f ' + (dataService.sensorFieldMap[field].unit == '%' ? '%%' : dataService.sensorFieldMap[field].unit) + ' '"
                                    [majorStep]="((dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]] && dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Min[intervalKeys[selectedIntervalId]]) ? (dataService.sensorFieldMap[field].majorStep * ((((dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]] - dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Min[intervalKeys[selectedIntervalId]]) / dataService.sensorFieldMap[field].majorStep / 10) + 0.5) | number:'2.0-0')) : dataService.sensorFieldMap[field].majorStep)">
                        </LinearAxis>
                        <DateTimeContinuousAxis tkCartesianHorizontalAxis allowZoom="true" allowPan="true" horizontalLocation="Left"
                                    labelMargin="5"
                                    dateFormat="{{'dd.MM' + (dataService.historyIntervalData[selectedIntervalId].stepUnit == 'Hour' ? ' HH:00' : '')}}"
                                    labelFitMode="Rotate"
                                    labelLayoutMode="outer"
                                    [minimum]="dataService.historyIntervalData[selectedIntervalId].dateInterval.start"
                                    [maximum]="dataService.historyIntervalData[selectedIntervalId].dateInterval.stop"
                                    [majorStepUnit]="dataService.historyIntervalData[selectedIntervalId].stepUnit"
                                    [majorStep]="dataService.historyIntervalData[selectedIntervalId].step">
                        </DateTimeContinuousAxis>
                        <RadCartesianChartGrid tkCartesianGrid horizontalLinesVisible="true"
                                    verticalLinesVisible="true"
                                    horizontalStripLinesVisible="true"
                                    verticalStripLinesVisible="true"
                                    verticalStrokeColor="#cccccc" horizontalStrokeColor="#cccccc"
                                    horizontalStrokeWidth="2" verticalstrokeWidth="2"
                                    horizontalStripLineColor="#eeeef9, #ffffff">
                        </RadCartesianChartGrid>
                        <LineSeries tkCartesianSeries
                                    [items]="dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data"
                                    categoryProperty="date"
                                    strokeColor="#356eb4"
                                    seriesName="dataLine"
                                    [valueProperty]="field"></LineSeries>
                        <LineSeries tkCartesianSeries
                                    [items]="alarmLineHigh"
                                    categoryProperty="date"
                                    strokeColor="red"
                                    seriesName="alarmLine"
                                    valueProperty="alarmValue"></LineSeries>
                        <LineSeries tkCartesianSeries
                                    [items]="alarmLineLow"
                                    categoryProperty="date"
                                    strokeColor="red"
                                    seriesName="alarmLine"
                                    valueProperty="alarmValue"></LineSeries>
                        <Palette tkCartesianPalette seriesName="dataLine">
                            <PaletteEntry tkCartesianPaletteEntry
                                          strokeColor="#356eb4"></PaletteEntry>
                        </Palette>
                        <Palette tkCartesianPalette seriesName="alarmLine">
                            <PaletteEntry tkCartesianPaletteEntry
                                          strokeColor="red"></PaletteEntry>
                        </Palette>
                    </RadCartesianChart>

                    <StackLayout *ngIf="dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]]">
                        <GridLayout rows="5,*,*" columns="10,30,*,*,10" paddingBottom="10">
                            <Label col=1 row=1 rowSpan="2" text="" class="alarm-symbol-fas alarm-gray"></Label>
                            <Label col="2" row="1" rowSpan="2" text="Maximum" class="alarm-blue font-weight-bold" verticalAlignment="center"></Label>
                            <Label col="3" row="1" [text]="dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Max[intervalKeys[selectedIntervalId]] + ' ' + dataService.sensorFieldMap[field].unit + ' '" class="alarm-blue pull-right font-weight-bold"></Label>
                            <Label col="3" row="2" [text]="(dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].MaxDate[intervalKeys[selectedIntervalId]] | date : 'dd.MM.yyyy HH:mm')" class="c-grey-dark pull-right"></Label>
                        </GridLayout>
                        <GridLayout rows="5,*,*", columns="10,30,*,*,10" paddingBottom="10">
                            <GridLayout col="1" row="0" colSpan="3" borderTopWidth="1" borderTopColor="#d3d3d3"></GridLayout>
                            <Label col=1 row=1 rowSpan="2" text="" class="alarm-symbol-fas alarm-gray"></Label>
                            <Label col="2" row="1" rowSpan="2" text="Minimum" class="alarm-blue font-weight-bold" verticalAlignment="center"></Label>
                            <Label col="3" row="1" [text]="dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].Min[intervalKeys[selectedIntervalId]] + ' ' + dataService.sensorFieldMap[field].unit + ' '" class="alarm-blue pull-right font-weight-bold"></Label>
                            <Label col="3" row="2" [text]="(dataService.boatHistory[dataService.deviceData[idDevice].id].sensor_data_minmax[field].MinDate[intervalKeys[selectedIntervalId]] | date : 'dd.MM.yyyy HH:mm')" class="c-grey-dark pull-right"></Label>
                        </GridLayout>
                    </StackLayout>
                </StackLayout>

                <StackLayout orientation="vertical" padding="10" class="alarm-card t-18"
                *ngIf="dataService.sensorFieldMap[field].note && dataService.sensorFieldMap[field].note != ''">
                    <Label text="{{'Note' | L}}" class="t-16 font-weight-bold alarm-card-simple-title"></Label>
                    <TextView fontSize="14"  class="sensor-detail-note" [text]="dataService.sensorFieldMap[field].note"></TextView>
                </StackLayout>


            </StackLayout>
        </ScrollView>
    </PullToRefresh>
    <MDActivityIndicator [busy]="false">
    </MDActivityIndicator>
    <GridLayout class="blob" *ngIf="dataService.isLoading">
        <Image col=0 row=1 src="~/assets/icon.png"></Image>
    </GridLayout>
</GridLayout>
