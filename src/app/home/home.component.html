<!--<ActionBar backgroundColor="#091525">
    <Label text="Home" color="white"></Label>
</ActionBar>-->

<GridLayout class="homeBackgroundImage"
            backgroundImage="~/assets/AppDesignSources_FreigestellteBilder_bg_harbour_w_bluesky.png">
    <PullToRefresh (refresh)="refreshList($event)">
        <ScrollView orientation="vertical">
            <GridLayout columns="*" rows="40, 100, 5, *" class="page__content">
                <Label col=0 row=0 text="" height="40"></Label>
                <Image col=0 row=1 src="~/assets/BOATOFFICER_Logo.png" class="boatofficer-logo"></Image>
                <Label col=0 row=2 text="" height="0"></Label>
                <StackLayout col=0 row=3 *ngIf="dataService">
                    <StackLayout *ngFor="let device of dataService.deviceData; let idDevice = index">
                        <Label text="" height="35"></Label>
                        <StackLayout [class]="device.boat_image_medium && device.boat_image_medium != 'null' ? 'boat-name' : 'alarm-button'" height="30pt">
                            <Label [text]="device.name" marginLeft="10" marginTop="3"></Label>
                        </StackLayout>
                        <StackLayout *ngIf="device.boat_image_medium && device.boat_image_medium != 'null'">
                            <Image class="boatoffice-boat-image-home" [src]="'' + device.boat_image_medium"></Image>
                        </StackLayout>
                        <StackLayout class="alarm-card-home" padding="10,10,10,10" *ngIf="device.sum_active_alarm > 0">
                            <GridLayout columns="0, *, auto, 10" rows="30" paddingBottom="-1">
                                <Label col=1 row=0 [text]="'ACTIVE ALARMS' | L" class="t-16 font-weight-bold"
                                       verticalAlignment="middle" horizontalAlignment="left"></Label>
                            </GridLayout>
                            <StackLayout *ngFor="let alarm of device.alarm; let idAlarm = index">
                                <StackLayout *ngIf="(alarm.status=='open' || (alarm.status=='open_someone_responsible' && alarm.i_am_responsible)) && alarm.index_type_active === 1">
                                    <GridLayout columns="0, 40, auto, auto" rows="40">
                                        <Label col=1 row=0 text="C" class="alarm-symbol alarm-orange"
                                               *ngIf="alarm.status == 'open'"></Label>
                                        <Label col=1 row=0 text="C" class="alarm-symbol alarm-blue"
                                               *ngIf="alarm.status == 'open_someone_responsible'"></Label>
                                        <Label col=1 row=0 text="C" class="alarm-symbol alarm-gray"
                                               *ngIf="alarm.status == 'marked_as_ok'"></Label>
                                        <Label col=1 row=0 text="C" class="alarm-symbol alarm-gray"
                                               *ngIf="alarm.status == 'clear_by_device'"></Label>
                                        <Label col=2 row=0 [text]="(alarm.type | L)" class="alarm-gray t-16 font-weight-bold"
                                               verticalAlignment="middle"></Label>
                                        <Label col=3 row=0 [text]="' ' + alarm.value + alarmByTypeMap[alarm.type].unit" class="alarm-gray t-16 font-weight-bold"
                                               verticalAlignment="middle" *ngIf="alarm.value"></Label>
                                    </GridLayout>
                                </StackLayout>
                            </StackLayout>
                        </StackLayout>
                        <StackLayout class="alarm-card-home" padding="10,10,10,10" *ngIf="device.sum_active_alarm === 0">
                            <GridLayout columns="0, *, auto, 10" rows="30" paddingBottom="-1">
                                <Label col=1 row=0 [text]="'ACTIVE ALARMS' | L" class="t-16 font-weight-bold"
                                       verticalAlignment="middle" horizontalAlignment="left"></Label>
                            </GridLayout>
                            <GridLayout columns="0, 40, auto, auto" rows="40">
                                <Label col=1 row=0 text="B" class="alarm-symbol alarm-green"></Label>
                                <Label col=2 row=0 [text]="('no active alarms' | L)" class="alarm-gray t-16 font-weight-bold"
                                       verticalAlignment="middle"></Label>
                            </GridLayout>
                        </StackLayout>
                        <StackLayout class="alarm-card-home" padding="10,10,10,10" marginBottom="10" *ngIf="dataService.boatStatus && dataService.boatStatus[device.id] && dataService.boatStatus[device.id].position_data && dataService.boatStatus[device.id].position_data.time">
                            <GridLayout columns="*, auto, 10" rows="40" paddingBottom="-10">
                                <Label col=0 row=0 [text]="'POSITION' | L" class="t-16 font-weight-bold"
                                       verticalAlignment="middle" horizontalAlignment="left"></Label>
                                <Label col=1 row=0 [text]="('Updated' | L) + ' ' + (dataService.boatStatus[device.id].position_data.time | timeago)"
                                       class="t-12 font-weight-bold"
                                       verticalAlignment="middle" horizontalAlignment="right"></Label>
                            </GridLayout>
                            <GridLayout columns="*, auto, 10" rows="20" paddingBottom="10">
                                <Label col=1 row=0 [text]="'(' + (dataService.boatStatus[device.id].position_data.time | date:'dd.MM.yyyy HH:mm z') + ')'"
                                       class="t-12 font-weight-normal"
                                       verticalAlignment="middle" horizontalAlignment="right"></Label>
                            </GridLayout>
                            <MapView height="200" #mapView [latitude]="dataService.boatStatus[device.id].position_data.latitude" [longitude]="dataService.boatStatus[device.id].position_data.longitude"
                                     [zoom]="zoom" [minZoom]="minZoom" [maxZoom]="maxZoom" [bearing]="bearing"
                                     [tilt]="tilt" i-padding="50,50,50,50" [padding]="padding" [mapAnimationsEnabled]="false"
                                     (mapReady)="onMapReady($event, idDevice)"
                                     (markerSelect)="onMarkerEvent($event)"
                                     (markerInfoWindowTapped)="onMarkerEvent($event)"></MapView>
                            <GridLayout columns="*, *, *, *" rows="40" paddingBottom="-10" *ngIf="dataService.boatStatus[device.id].weather">
                                <Label col=0 row=0 [text]="(dataService.boatStatus[device.id].weather.main.temp | number: '1.0-0') + 'Â°C'" class="t-16 font-weight-bold"
                                       verticalAlignment="middle" horizontalAlignment="center"></Label>
                                <Label col=1 row=0 [text]="dataService.boatStatus[device.id].weather.weather[0].icon" class="weather-font"
                                        verticalAlignment="middle" horizontalAlignment="center"></Label>
                                <Label col=2 row=0 [text]="dataService.boatStatus[device.id].weather.wind.beaufort_icon" class="weather-font"
                                        verticalAlignment="middle" horizontalAlignment="center"></Label>
                                <Label col=3 row=0 [text]="dataService.boatStatus[device.id].weather.wind.direction_icon" class="weather-font"
                                        verticalAlignment="middle" horizontalAlignment="center" [rotate]="dataService.boatStatus[device.id].weather.wind.deg + 180"></Label>
                            </GridLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </GridLayout>
        </ScrollView>
    </PullToRefresh>
</GridLayout>
