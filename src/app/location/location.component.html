<ActionBar title="{{'LOCATION' | L}}" class="action-bar bg-darkblue">
    <!--    <NavigationButton text="{{'Back' | L}}" android.systemIcon="ic_menu_back"></NavigationButton>-->
    <Label text="{{'LOCATION' | L}}" class="alarm-text"
        (tap)="toggleAllBoatDetails($event)"></Label>

<!--    <ActionItem
            ios.position="right"
            android.position="right">
        <Label class="alarm-symbol alarm-blue"
               text="M" [nsRouterLink]="'../settings'" pageTransition="slideLeft">
        </Label>
    </ActionItem>-->
</ActionBar>


<GridLayout id="level_2" class="homeBackgroundImage"
            backgroundImage="~/assets/AppDesignSources_FreigestellteBilder_bg_harbour_gray.png">
    <PullToRefresh id="level_3" (refresh)="refreshList($event)">
        <ScrollView id="level_4" orientation="vertical" iosOverflowSafeArea="false">
            <GridLayout>
                <StackLayout id="level_5_no_key" *ngIf="!dataService.loggedIn">
                    <StackLayout class="alarm-card-home">
                        <GridLayout columns="*" rows="auto" padding = "5">
                            <Label col=0 row=0 [text]="'no_key' | L" class="t-16 c-black" textWrap="true"
                                   verticalAlignment="middle" horizontalAlignment="left"></Label>
                        </GridLayout>
                    </StackLayout>
                </StackLayout>
                <StackLayout id="level_5_no_boat" *ngIf="dataService.loggedIn && (dataService.noBoat && dataService.isLoading == false)">
                    <StackLayout class="alarm-card-home">
                        <GridLayout columns="*" rows="auto" padding = "5">
                            <Label col=0 row=0 [text]="'no_boat' | L" class="t-16 c-black" textWrap="true"
                                   verticalAlignment="middle" horizontalAlignment="left"></Label>
                        </GridLayout>
                    </StackLayout>
                </StackLayout>
                <StackLayout id="level_5" *ngIf="dataService.loggedIn">
                    <StackLayout [id]="'level_6_' + device.id" *ngFor="let device of dataService.deviceData; let idDevice = index">
                        <StackLayout (tap)="toggleBoatDetails(device.id)">
                            <boat-header [boatname]="device.name" [boat_image_small]="device.boat_image_small" [role]="device.role" [deviceType]="device.type"></boat-header>
                        </StackLayout>
                        <StackLayout class="boat-details" [id]="'boat-details' + device.id" visibility="collapse">


                            <StackLayout [id]="'level_7_' + device.id" class="alarm-card"
                                         *ngIf="dataService.boatStatus && dataService.boatStatus[device.id] && dataService.boatStatus[device.id].position_data && dataService.boatStatus[device.id].position_data.time">
                                <alarm-card-4segments-title [title]="'POSITION' | L" [updatedatetime]="dataService.boatStatus[device.id].position_data.time"  [warning]="''"
                                                            *ngIf="device.bad_gps_signal == false"></alarm-card-4segments-title>
                                <alarm-card-4segments-title [title]="'POSITION' | L" [updatedatetime]="dataService.boatStatus[device.id].position_data.time"  [warning]="('GPS Reception' | L)"
                                                            *ngIf="device.bad_gps_signal == true"></alarm-card-4segments-title>
                                <GridLayout columns="*, 40" rows="*, 40" [id]="'level_8_' + device.id" *ngIf="dataService.boatStatus[device.id].position_data.latitude != 0">
                                    <MapView col="0" row="0" rowSpan="2" colSpan="2" [id]="'mapview_' + device.id" height="150" #mapView [latitude]="dataService.boatStatus[device.id].position_data.latitude" [longitude]="dataService.boatStatus[device.id].position_data.longitude"
                                             [zoom]="zoom" [minZoom]="minZoom" [maxZoom]="maxZoom" [bearing]="bearing"
                                             [tilt]="tilt" padding="5, 5, 5, 5" [mapAnimationsEnabled]="false"
                                             (mapReady)="onMapReady($event, idDevice)"
                                             (markerSelect)="onMarkerEvent($event)"
                                             (markerInfoWindowTapped)="onMarkerEvent($event)"></MapView>
                                    <Label col="0" row="1" colSpan="2" class="shadow-overlay-bottom-alarm-red"  *ngIf="device.mode == 'SOS' || device.mode == 'Unacknowledged Movement'"></Label>
                                    <Label col="0" row="1" colSpan="2" class="shadow-overlay-bottom-alarm-blue" *ngIf="device.mode != 'SOS' && device.mode != 'Unacknowledged Movement' && device.mode != ''"></Label>
                                    <Label col="0" row="1" class="text-overlay-bottom-left" [text]="(device.mode + ' active') | L" *ngIf="device.mode != ''"></Label>
                                    <Label col="1" row="1" [text]="''"
                                           class="fa-symbol-overlay-bottom-right"  *ngIf="device.mode == 'SOS'"></Label>
                                    <Label col="1" row="1" [text]="''"
                                           class="fa-symbol-overlay-bottom-right"  *ngIf="device.mode == 'Race Mode'"></Label>
                                    <Label col="1" row="1" [text]="''"
                                           class="fa-symbol-overlay-bottom-right"  *ngIf="device.mode == 'Mapping'"></Label>
                                    <GridLayout col="0" row="0" rowSpan="2" colSpan="2" [nsRouterLink]="['../mapdetails', idDevice]"></GridLayout>
                                </GridLayout>
                            </StackLayout>
                            <StackLayout [id]="device.id" class="alarm-card"
                                         *ngIf="dataService.boatStatus && dataService.boatStatus[device.id] && dataService.boatStatus[device.id].weather_forecast && dataService.boatStatus[device.id].weather_forecast.list && dataService.boatStatus[device.id].weather_forecast.list[0]" (tap)="onWeatherTap(device.id)">
                                <Label [text]="'WEATHER ON SITE' | L" class="t-16 font-weight-bold c-black alarm-card-simple-title"
                                       horizontalAlignment="left"></Label>
                                <GridLayout *ngIf="dataService.boatStatus[device.id].weather_forecast">
                                    <StackLayout>
                                        <GridLayout *ngFor="let forecast of dataService.boatStatus[device.id].weather_forecast.list; let idList = index">
                                            <GridLayout columns="37, *, 37, 42, 42, 37, 32" rows="30" [color]="forecast.is_night ? '#444444' : '#356eb4'" *ngIf="(maxWeather && maxWeather[device.id]) ? idList < maxWeather[device.id] : idList < 3" class="weather-row">
                                                <Label col=0 row=0 [text]="(((forecast.dt - dataService.boatStatus[device.id].weather_forecast.city.timezone) * 1000) | date: 'EEE') | L" class="t-16 font-weight-bold c-black"
                                                       horizontalAlignment="left"></Label>
                                                <Label col=1 row=0 [text]="((forecast.dt - dataService.boatStatus[device.id].weather_forecast.city.timezone) * 1000) | date: 'HH:mm'" class="t-16 font-weight-bold c-black"
                                                       horizontalAlignment="left"></Label>
                                                <Label col=2 row=0 [text]="'C'" class="alarm-symbol-weather alarm-orange"
                                                       horizontalAlignment="left"
                                                       *ngIf="dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user >= forecast.main.temp"></Label>
                                                <Label col=2 row=0 [text]="'C'" class="alarm-symbol-weather alarm-orange"
                                                       horizontalAlignment="left"
                                                       *ngIf="dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'] && !dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_device && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_device >= forecast.main.temp"></Label>
                                                <Label col=2 row=0 [text]="'C'" class="alarm-symbol-weather alarm-orange"
                                                       horizontalAlignment="left"
                                                       *ngIf="dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user <= forecast.main.temp"></Label>
                                                <Label col=2 row=0 [text]="'C'" class="alarm-symbol-weather alarm-orange"
                                                       horizontalAlignment="left"
                                                       *ngIf="dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'] && !dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_device && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_device <= forecast.main.temp"></Label>
                                                <Label col=2 row=0 [text]="'C'" class="alarm-symbol-weather alarm-orange"
                                                       horizontalAlignment="left"
                                                       *ngIf="forecast.wind.beaufort >= beaufortAlarmLevel"></Label>
                                                <Label col=3 row=0 [text]="(forecast.main.temp | number: '1.0-0') + '°C'" [class]="'t-16 font-weight-bold' + (
                                                        ((
                                                            dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user >= forecast.main.temp
                                                        ) || (
                                                            dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'] && !dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_device && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingLowInDegreesC'].value_device >= forecast.main.temp
                                                        ) || (
                                                            dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user <= forecast.main.temp
                                                        ) || (
                                                            dataService.alarmSettings && dataService.alarmSettings[device.id] && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'] && !dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_user && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_device && dataService.alarmSettings[device.id]['UserCfg_IntTemperatureAlarmSettingHighInDegreesC'].value_device <= forecast.main.temp
                                                        ))
                                                        ? ' alarm-orange' : '')"
                                                       horizontalAlignment="right"></Label>
                                                <Label col=4 row=0 [text]="forecast.weather[0].icon" class="weather-font"
                                                       horizontalAlignment="right"></Label>
                                                <Label col=5 row=0 [text]="forecast.wind.beaufort_icon" [class]="'weather-font' + (forecast.wind.beaufort >= beaufortAlarmLevel ? ' alarm-orange' : '')"
                                                       horizontalAlignment="right"></Label>
                                                <Label col=6 row=0 [text]="forecast.wind.direction_icon" class="weather-font"
                                                       horizontalAlignment="right" [rotate]="forecast.wind.deg + 180"></Label>
                                            </GridLayout>
                                        </GridLayout>
                                    </StackLayout>
                                </GridLayout>
                                <GridLayout columns="*, *" rows="40" paddingBottom="-5" *ngIf="dataService.boatStatus && dataService.boatStatus[device.id] && dataService.boatStatus[device.id].weather_forecast">
                                    <GridLayout col=0 row=0 columns="40, *" rows="40" horizontalAlignment="center">
                                        <Label col=0 row=0 [text]="dataService.boatStatus[device.id].weather_forecast.city.icon_sunrise" class="weather-font c-black"
                                               verticalAlignment="middle" horizontalAlignment="left"></Label>
                                        <Label col=1 row=0 [text]="(dataService.boatStatus[device.id].weather_forecast.city.sunrise * 1000 | date : 'HH:mm')" class="t-16 font-weight-bold c-black"
                                               verticalAlignment="middle" horizontalAlignment="left"></Label>
                                    </GridLayout>
                                    <GridLayout col=1 row=0 columns="40, *" rows="40" horizontalAlignment="center">
                                        <Label col=0 row=0 [text]="dataService.boatStatus[device.id].weather_forecast.city.icon_sunset" class="weather-font c-black"
                                               verticalAlignment="middle" horizontalAlignment="left"></Label>
                                        <Label col=1 row=0 [text]="(dataService.boatStatus[device.id].weather_forecast.city.sunset * 1000 | date : 'HH:mm')" class="t-16 font-weight-bold c-black"
                                               verticalAlignment="middle" horizontalAlignment="left"></Label>
                                    </GridLayout>
                                </GridLayout>
                            </StackLayout>
                            <GridLayout *ngIf="thingIsVisible[device.id]">
                                <StackLayout class="alarm-card" *ngIf="dataService.boatStatus && dataService.boatStatus[device.id] && dataService.boatStatus[device.id].nearest_webcam && dataService.boatStatus[device.id].nearest_webcam.url">
                                    <alarm-card-4segments-title [title]="'WEBCAM' | L" [subtitletop]="dataService.boatStatus[device.id].nearest_webcam.location_name"  [subtitlebottom]="dataService.boatStatus[device.id].nearest_webcam.name"></alarm-card-4segments-title>
                                    <GridLayout columns="*" rows="240" paddingBottom="0" [id]="'webcam_'+idDevice" *ngIf="dataService.boatStatus[device.id].nearest_webcam.url" >
                                        <GridLayout id="GridLayout-webcam" [columns]="webcamWidth[device.id] ? webcamWidth[device.id] : '*'" [rows]="webcamHeight[device.id] ? webcamHeight[device.id] : 240">
                                            <WebView [id]="device.id"
                                                     [src]="'' + dataService.boatStatus[device.id].nearest_webcam.url"
                                                     (loadStarted)="onLoadStarted($event)"
                                                     (loadFinished)="onLoadFinishedWebView($event)">
                                            </WebView>
                                        </GridLayout>
                                        <GridLayout [nsRouterLink]="['../webcam', idDevice]"></GridLayout>
                                    </GridLayout>
                                </StackLayout>
                            </GridLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </GridLayout>
        </ScrollView>
    </PullToRefresh>
    <MDActivityIndicator [busy]="false">
    </MDActivityIndicator>
    <GridLayout class="blob" *ngIf="dataService.isLoadingLatestSensorData">
        <Image col=0 row=1 src="~/assets/icon.png"></Image>
    </GridLayout>
</GridLayout>
